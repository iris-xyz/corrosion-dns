# Unbound configuration for corrosion-dns deployment.
#
# Unbound sits at the WireGuard address that microVMs use as their nameserver.
# It forwards the internal zone to corrosion-dns and resolves everything else
# via upstream DNS.
#
# The microVM's /etc/resolv.conf just has:
#   nameserver fdaa::3
#
# And everything works â€” internal names go to corrosion-dns, external names
# go to upstream resolvers.

server:
    # Listen on the WireGuard address that microVMs can reach.
    # Change this to your actual interface address.
    interface: fdaa::3
    interface: 127.0.0.1

    # Only serve on port 53 (standard DNS).
    port: 53

    # Allow queries from the WireGuard network.
    # Adjust the prefix to match your network.
    access-control: fdaa::/16 allow
    access-control: 127.0.0.0/8 allow

    # Don't expose to the internet.
    access-control: 0.0.0.0/0 refuse
    access-control: ::0/0 refuse

    # Performance: one thread is fine for small deployments.
    num-threads: 1

    # Logging
    verbosity: 1
    log-queries: no

    # Disable DNSSEC for internal zone (corrosion-dns doesn't sign).
    domain-insecure: "apps.example.com"

# Internal zone: forward to corrosion-dns.
# corrosion-dns handles *.apps.example.com with group filtering.
stub-zone:
    name: "apps.example.com"
    stub-addr: 127.0.0.1@5353
    stub-no-cache: yes

# Everything else: forward to upstream resolvers.
forward-zone:
    name: "."
    forward-addr: 8.8.8.8
    forward-addr: 1.1.1.1
    forward-addr: 2001:4860:4860::8888
    forward-addr: 2606:4700:4700::1111
